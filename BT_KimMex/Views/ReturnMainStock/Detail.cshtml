@model BT_KimMex.Models.ReturnMainStockViewModel
@using BT_KimMex.Class
@using Microsoft.AspNet.Identity;
@{
    ViewBag.Title = "Detail";
    string date =CommonClass.ToLocalTime(Convert.ToDateTime(Model.create_date)).ToString("dd/MM/yyyy");
    string userid = User.Identity.GetUserId().ToString();
    BT_KimMex.Entities.kim_mexEntities db=new BT_KimMex.Entities.kim_mexEntities();
}
<style type="text/css">
    #st_table tr td{
        vertical-align:middle !important;
    }
    #st_table tr td:nth-child(4),#st_table tr td:nth-child(6){
        text-align:center !important;
    }
</style>

<div class="w3-container">
    <h3 class="title">View Return to Workshop Detail</h3>
</div>

<div class="w3-container">
    <div class="row">
        <div class="form-group">
            @Html.Label("Date:", new { @class = "col-md-2" })
            @Html.Label(date, new { @class = "col-md-10" })
        </div>
        <div class="form-group">
            <label class="col-md-2">Return Number:</label>
            <label class="col-md-10">@Model.return_main_stock_no</label>
        </div>
        @*<div class="form-group">
                <label class="control-label col-md-2">Return Type:</label>
                @Html.DisplayFor(model => model.return_type, new { @class = "col-md-10" })
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">Transfer Ref.:</label>
                @Html.DisplayFor(model => model.return_ref_number, new { @class = "col-md-10" })
            </div>*@
        <div class="form-group">
            <label class="col-md-2">Project Name:</label>
            <div class="col-md-10">
                <label id="project">@Model.project_fullname</label>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2">From Warehouse:</label>
            <div class="col-md-10">
                <label id="warehouse">@Model.warehouse_name</label>
            </div>
        </div>
    </div>

    <div class="row" style="margin:0 !important;">
        <table class="table table-bordered" id="st_table">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    @*<th>Transfered QTY</th>*@
                    <th>Return QTY</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int count = 1;
                    foreach (var item in Model.inventoryDetails)
                    {
                        <tr>
                            <td>@count</td>
                            <td>@item.itemCode</td>
                            <td>@item.itemName</td>
                            @*<td></td>*@
                            <td>@item.out_quantity @item.unitName</td>
                            <td>@item.item_status</td>
                        </tr>
                        count++;
                    }
                }
            </tbody>
        </table>
    </div>

    @if (string.Compare(Model.return_main_stock_status, Status.RequestCancelled) == 0)
    {
        <div class="row">
            <label class="col-md-2">Request Cancelled Reason:</label>
            <label class="col-md-10">@Model.last_approved_by</label>
        </div>
    }

    <div class="form-group">
        <div class="col-lg-offset-2 col-lg-10">
            @{
                if (User.IsInRole(Role.SystemAdmin) || string.Compare(Model.create_by, userid) == 0)
                {
                    if (string.Compare(Model.return_main_stock_status, Status.Pending) == 0)
                    {
                        @*@Html.ActionLink("Edit", "Edit", new { id = Model.return_main_stock_id }, new { @class = "btn btn-success" })*@
                        <button class="w3-button w3-small w3-deep-orange" id="btn-cancel"> Request Cancel</button>
                    }
                    else if (string.Compare(Model.return_main_stock_status, Status.PendingFeedback) == 0)
                    {
                        @Html.ActionLink("Prepare Feedback", "PrepareFeedback", new { id = Model.return_main_stock_id }, new { @class = "w3-button w3-green w3-small" })
                    }

                }
                if ((User.IsInRole(Role.SystemAdmin) || User.IsInRole(Role.QAQCOfficer)) && (Model.return_main_stock_status == Status.Pending || Model.return_main_stock_status == Status.Feedbacked))
                {
                    @*<a href="javascript:void(0)" id="@Model.stock_transfer_id" class="btn btn-default approve-promp">Approve</a>
                        <a href="javascript:void(0)" id="@Model.stock_transfer_id" class="btn btn-default reject-promp">Reject</a>*@
                    @Html.ActionLink("Approve/ Feedback", "ApproveFeedback", "ReturnMainStock", new { id = Model.return_main_stock_id }, new { @class = "w3-button w3-green w3-small" })
                }
                if ((User.IsInRole(Role.SystemAdmin) || User.IsInRole(Role.ProjectManager)) && string.Compare(Model.return_main_stock_status, Status.Approved) == 0)
                {
                    <a href="javascript:void(0)" class="w3-button w3-small w3-green" id="btn-approve">Approve</a>
                    <a href="javascript:void(0)" class="w3-button w3-small w3-red" id="btn-reject">Reject</a>
                }
                if ((User.IsInRole(Role.SystemAdmin) || User.IsInRole(Role.WorkshopController)) && string.Compare(Model.return_main_stock_status, Status.Checked) == 0)
                {
                    <a href="javascript:void(0)" class="w3-button w3-small w3-green" id="btn-check-approve">Approve</a>
                    <a href="javascript:void(0)" class="w3-button w3-small w3-red" id="btn-check-reject">Reject</a>
                }
            }

            <a href="javascript:history.back()" class="w3-button w3-small w3-red">Back</a>
        </div>
    </div>
    @*@if (Model.rejects.Count() > 0)
        {
            <div class="form-group">
                <label class="control-label col-md-2">Reject Command:</label>
                <div class="col-md-10">
                    <ul>
                        @foreach (var reject in Model.rejects)
                        {
                            <li>@reject.comment <b>By @reject.rejected_by</b></li>
                        }
                    </ul>
                </div>
            </div>
        }*@

</div>
<div class="w3-container">

</div>


@section Scripts{
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {

            $('#btn-cancel').click(function (e) {
                e.preventDefault();
                swal({
                    title: "Cancellation",
                    text: "Please input your cancel comment:",
                    icon: "warning",
                    content: "input",
                })
                .then((value) => {
                    $.ajax({
                        url: "/ReturnMainStock/CancelRequest",
                        data: {
                            'id': '@Model.return_main_stock_id',
                            'comment': value,
                        },
                        type: 'GET',
                        success: function (da) {
                            swal("Request has been cancelled successfully.", {
                                icon: "success",
                            });
                            window.location.href = '@Url.Action("Index", "ReturnMainStock")';
                        },
                        error: function (err) {
                            swal("Poof! " + err, {
                                icon: "error",
                            });
                        }
                    });
                });
            });

            $("#btn-approve").click(function (e) {
                e.preventDefault();
                swal({
                    title: "Confirmation",
                    text: "Do you want to approve this request?",
                    icon: "warning",
                    buttons: true,
                    //dangerMode: true,
                })
                .then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            url: "/ReturnMainStock/Approval",
                            data: {
                                'id': '@Model.return_main_stock_id',
                                'status': 'approved',
                                'comment': '',
                            },
                            type: 'GET',
                            success: function (da) {
                                swal("Request has been approved successfully.", {
                                    icon: "success",
                                });
                                window.location.href = '@Url.Action("Index", "ReturnMainStock")';
                            },
                            error: function (err) {
                                swal("Poof! " + err, {
                                    icon: "error",
                                });
                            }
                        });



                    } else {
                        //swal("Your imaginary file is safe!");
                    }
                });
            });

            $("#btn-check-approve").click(function (e) {
                e.preventDefault();
                swal({
                    title: "Confirmation",
                    text: "Do you want to approve this request?",
                    icon: "warning",
                    buttons: true,
                    //dangerMode: true,
                })
                .then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            url: "/ReturnMainStock/Completed",
                            data: {
                                'id': '@Model.return_main_stock_id',
                                'status': 'approved',
                                'comment': '',
                            },
                            type: 'GET',
                            success: function (da) {
                                swal("Request has been approved successfully.", {
                                    icon: "success",
                                });
                                window.location.href = '@Url.Action("Index", "ReturnMainStock")';
                            },
                            error: function (err) {
                                swal("Poof! " + err, {
                                    icon: "error",
                                });
                            }
                        });



                    } else {
                        //swal("Your imaginary file is safe!");
                    }
                });
            });

            $('#btn-reject').click(function (e) {
                e.preventDefault();
                swal({
                    title: "Rejection",
                    text: "Please input your reject comment:",
                    icon: "warning",
                    content: "input",
                })
                .then((value) => {
                    $.ajax({
                        url: "/ReturnMainStock/Approval",
                        data: {
                            'id': '@Model.return_main_stock_id',
                            'status': 'rejected',
                            'comment': value,
                        },
                        type: 'GET',
                        success: function (da) {
                            swal("Request has been rejected successfully.", {
                                icon: "success",
                            });
                            window.location.href = '@Url.Action("Index", "ReturnMainStock")';
                        },
                        error: function (err) {
                            swal("Poof! " + err, {
                                icon: "error",
                            });
                        }
                    });
                });
            });

            $('#btn-check-reject').click(function (e) {
                e.preventDefault();
                swal({
                    title: "Rejection",
                    text: "Please input your reject comment:",
                    icon: "warning",
                    content: "input",
                })
                .then((value) => {
                    $.ajax({
                        url: "/ReturnMainStock/Completed",
                        data: {
                            'id': '@Model.return_main_stock_id',
                            'status': 'rejected',
                            'comment': value,
                        },
                        type: 'GET',
                        success: function (da) {
                            swal("Request has been rejected successfully.", {
                                icon: "success",
                            });
                            window.location.href = '@Url.Action("Index", "ReturnMainStock")';
                        },
                        error: function (err) {
                            swal("Poof! " + err, {
                                icon: "error",
                            });
                        }
                    });
                });
            });
        });
    </script>

   
    }


